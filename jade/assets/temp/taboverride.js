jQuery.fn.tabOverride=function(t){function e(t){var e,i,l,h,c,d,u,p,f,v,m,g,y,$,w,b,C,x,k=t.keyCode;if((9===k||13===k&&o.autoIndent)&&!t.ctrlKey&&!t.altKey){if(r=!1,l=this.value,p=this.scrollTop,document.selection)h=document.selection.createRange(),m=h.text,c=h.duplicate(),c.moveToElementText(this),c.setEndPoint("EndToEnd",h),v=c.text.length,f=v-m.length,s>1?(d=l.slice(0,f).split(n).length-1,u=m.split(n).length-1):d=u=0;else{if(void 0===this.selectionStart)return;f=this.selectionStart,v=this.selectionEnd,m=l.slice(f,v)}if(9===k)e=a,i=e.length,$=0,w=0,b=0,f!==v&&-1!==m.indexOf("\n")?(g=0===f||"\n"===l.charAt(f-1)?f:l.lastIndexOf("\n",f-1)+1,v===l.length||"\n"===l.charAt(v)?y=v:(y=l.indexOf("\n",v),-1===y&&(y=l.length)),t.shiftKey?(0===l.slice(g).indexOf(e)&&(g===f?m=m.slice(i):b=i,w=i),this.value=l.slice(0,g)+l.slice(g+b,f)+m.replace(RegExp("\n"+e,"g"),function(){return $+=1,"\n"})+l.slice(v),h?(h.collapse(),h.moveEnd("character",v-w-$*i-u-d),h.moveStart("character",f-b-d),h.select()):(this.selectionStart=f-b,this.selectionEnd=v-w-$*i)):($=1,this.value=l.slice(0,g)+e+l.slice(g,f)+m.replace(/\n/g,function(){return $+=1,"\n"+e})+l.slice(v),h?(h.collapse(),h.moveEnd("character",v+$*i-u-d),h.moveStart("character",f+i-d),h.select()):(this.selectionStart=f+i,this.selectionEnd=v+$*i,this.scrollTop=p))):t.shiftKey?0===l.slice(f-i).indexOf(e)&&(this.value=l.slice(0,f-i)+l.slice(f),h?(h.move("character",f-i-d),h.select()):(this.selectionEnd=this.selectionStart=f-i,this.scrollTop=p)):h?(h.text=e,h.select()):(this.value=l.slice(0,f)+e+l.slice(v),this.selectionEnd=this.selectionStart=f+i,this.scrollTop=p);else if(o.autoIndent){if(0===f||"\n"===l.charAt(f-1))return r=!0,void 0;if(g=l.lastIndexOf("\n",f-1)+1,y=l.indexOf("\n",f),-1===y&&(y=l.length),C=l.slice(g,y).match(/^[ \t]*/)[0],x=C.length,g+x>f)return r=!0,void 0;h?(h.text="\n"+C,h.select()):(this.value=l.slice(0,f)+"\n"+C+l.slice(v),this.selectionEnd=this.selectionStart=f+s+x,this.scrollTop=p)}t.preventDefault()}}function i(t){var e=t.keyCode;9!==e&&(13!==e||!o.autoIndent||r)||t.ctrlKey||t.altKey||t.preventDefault()}var n,s,o,a="	",r=!1,l=document.createElement("textarea");return o=function(n){return this.each(function(){t(this).unbind(".tabOverride")}),(!arguments.length||n)&&this.each(function(){this.nodeName&&"textarea"===this.nodeName.toLowerCase()&&t(this).bind("keydown.tabOverride",e).bind("keypress.tabOverride",i)}),this},o.getTabSize=function(){return o.tabSize()},o.setTabSize=function(t){o.tabSize(t)},o.tabSize=function(t){if(!arguments.length)return"	"===a?0:a.length;var e;if(t){if("number"==typeof t&&t>0)for(a="",e=0;t>e;e+=1)a+=" "}else a="	"},o.autoIndent=!1,l.value="\n",n=l.value,s=n.length,l=null,o}(jQuery);