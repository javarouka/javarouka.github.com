<!DOCTYPE html>
<html>
<head lang="ko">
    <meta charset="UTF-8">
    <title>양방향 바인딩</title>
</head>
<body>

    <div data-binder>
        <input id="sample1" data-bound="test1" value="">
        <input id="sample2" data-bound="test2" value="">
    </div>

    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script>

        function bindTwoWay(scope, listeners) {

            if(typeof Object.observe === 'function') {
                console.log(scope, listeners);
                Object.observe(scope, function(change) {
                    change = change[0];
                    for(var k in change) {
                        console.log(k, listeners[k]);
                        if(listeners[k]) {
                            var o = listeners[k],
                                v = change[k];
                            o.target[o.prop] = v;
                        }
                    }
                })
            }
            else if(typeof Object.defineProperty === 'function') {
            }
            else {
                // Opps... Timer?
            }
        }

        $(function() {

            var dataBinder = $("[data-binder]"),
                scope = {},
                listeners = {};

            dataBinder.each(function(i, p) {
                $(p).find("[data-bound]").each(function(i, b) {
                    var bound = $(b).data("bound");
                    if(!Array.isArray(listeners[bound])) {
                        listeners[bound] = [];
                    }
                    listeners[bound].push({
                        target: b,
                        prop: "value"
                    })
                });
            });

            bindTwoWay(scope, listeners);

            window.$scope = scope;
            window.listeners = listeners
        });

    </script>

</body>
</html>